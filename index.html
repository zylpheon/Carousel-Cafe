<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Carousel | Home</title>
    <link rel="icon" type="image/x-icon" href="image/logo.png" />
    <link rel="stylesheet" href="bootstrap-5.0.0-dist/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="dist/css/lightbox.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap"
      rel="stylesheet"
    />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
  </head>
  <body>
    <!-- Navbar Start -->
    <nav
      class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark linear-color under-shadow"
      data-aos="fade-down"
    >
      <div class="container-fluid">
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <a class="navbar-brand me-auto nav-link" href="#"
            ><img
              src="image/logo.png"
              alt=""
              width="35"
              height="35"
              alt="Carousel"
            />Carousel Cafe</a
          >
          <ul class="navbar-nav">
            <li class="nav-item me-5">
              <a class="nav-link active" aria-current="page" href="#"
                ><i class="bi bi-house me-2"></i>Home</a
              >
            </li>
            <li class="nav-item me-5">
              <a class="nav-link" href="product.html"
                ><i class="bi bi-three-dots me-2"></i>Menu</a
              >
            </li>
            <li class="nav-item me-5">
              <a class="nav-link" href="promo.html"
                ><i class="bi bi-tag me-2"></i>Promo</a
              >
            </li>
            <li class="nav-item me-5">
              <a
                class="nav-link"
                href="order.html"
                tabindex="-1"
                aria-disabled="true"
                ><i class="bi bi-cart me-2"></i>Order</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Navbar End -->

    <!-- Banner Start -->
    <div class="container-fluid banner d-flex align-items-center">
      <div class="container no-select">
        <h1 class="text-light text-center display-5 mb-3" data-aos="zoom-in">
          ~Welcome to Carousel Cafe~
        </h1>
        <h2 class="text-light text-center display-7 mb-4" data-aos="zoom-in">
          * SINCE 1996 *
        </h2>
        <div class="col-md-8 offset-md-2">
          <div class="input-group input-group-lg" data-aos="zoom-in">
            <select
              class="form-control"
              id="inputGroupSelect04"
              aria-label="Example select with button addon"
            >
              <option selected hidden>Choose category...</option>
              <option value="1">Cakes</option>
              <option value="2">Cookies</option>
              <option value="3">Breads</option>
              <option value="4">Pastries</option>
              <option value="5">Seasonal Specials</option>
            </select>
            <button
              class="btn btn-lg btn-warning text-light"
              type="button"
              id="search-btn"
            >
              Search
            </button>

            <!-- Script Start -->
            <script>
              document
                .getElementById("search-btn")
                .addEventListener("click", function () {
                  const select = document.getElementById("inputGroupSelect04");
                  const selectedIndex = select.selectedIndex;

                  if (selectedIndex > 0) {
                    // Skip the "Choose category" option
                    const categoryText = select.options[selectedIndex].text;
                    window.location.href = `./product.html?category=${encodeURIComponent(
                      categoryText
                    )}`;
                  }
                });
            </script>
            <!-- Script End -->
          </div>
        </div>
      </div>
    </div>
    <!-- Banner End -->

    <!-- Promo Start -->
    <div class="container-fluid py-5">
      <div class="container">
        <h2 class="text-center no-select" data-aos="fade-up">Special Offer</h2>
        <div
          class="row mt-5 justify-content-center"
          id="special-offers-container"
        >
          <!-- Special offers will be dynamically inserted here -->
        </div>
        <div class="mt-5 d-flex justify-content-center">
          <a
            href="promo.html"
            class="btn btn-warning btn-lg text-light under-shadow3"
            data-aos="zoom-in"
            >See More</a
          >
        </div>
      </div>
    </div>
    <!-- Promo End -->

    <!-- Service Start -->
    <div class="container-fluid py-5 linear-color">
      <div class="container">
        <h2 class="text-light text-center mb-5 no-select" data-aos="zoom-in">
          Service
        </h2>
        <div class="row justify-content-center text-white text-center">
          <div class="col-sm-6 col-lg-3 mb-3" data-aos="fade-up">
            <div class="d-flex justify-content-center">
              <div
                class="icon-service d-flex align-items-center justify-content-center"
              >
                <i class="bi bi-bicycle display-6"></i>
              </div>
            </div>
            <div>
              <h5 class="mt-3">Delivery</h5>
              <p>
                Enjoy our freshly baked goods from the comfort of your home!
                Fast and reliable delivery ensures your favorite treats arrive
                warm and delicious, right at your doorstep.
              </p>
            </div>
          </div>
          <div
            class="col-sm-6 col-lg-3 mb-3"
            data-aos="fade-up"
            data-aos-duration="650"
          >
            <div class="d-flex justify-content-center">
              <div
                class="icon-service d-flex align-items-center justify-content-center"
              >
                <i class="bi bi-basket display-6"></i>
              </div>
            </div>
            <div>
              <h5 class="mt-3 text-white text-center">Take Away</h5>
              <p>
                On the go? Grab your favorite pastries and bread with our quick
                and easy take-away service. Freshly prepared and packed for your
                convenience!
              </p>
            </div>
          </div>
          <div
            class="col-sm-6 col-lg-3 mb-3"
            data-aos="fade-up"
            data-aos-duration="850"
          >
            <div class="d-flex justify-content-center">
              <div
                class="icon-service d-flex align-items-center justify-content-center"
              >
                <i class="bi bi-cup-straw display-6"></i>
              </div>
            </div>
            <div>
              <h5 class="mt-3 text-white text-center">Dine In</h5>
              <p>
                Experience the cozy ambiance of our bakery while indulging in
                our handcrafted well-baked goods. Sit back, relax, and enjoy a
                delightful dining experience with us.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Service End -->

    <!-- Product Start -->
    <div class="container-fluid py-5">
      <div class="container">
        <h2 class="text-center mb-5 no-select" data-aos="zoom-in">
          Favourites
        </h2>
        <div class="row mt-5 justify-content-center" id="favorites-container">
          <!-- Favorites items will be dynamically inserted here -->
        </div>
      </div>
      <div class="mt-5 d-flex justify-content-center">
        <a
          href="product.html"
          class="btn btn-warning btn-lg text-light"
          data-aos="zoom-in"
          >See More</a
        >
      </div>
    </div>
    <!-- Product End -->

    <!-- Review Start -->
    <div class="container-fluid py-5 linear-color">
      <div class="container">
        <h2 class="text-light text-center mb-5 no-select" data-aos="zoom-in">
          Reviews
        </h2>
        <div class="row" data-masonry='{"percentPosition": true }'>
          <div class="col-lg-4 mb-3" data-aos="fade-up">
            <div class="card p-3">
              <figure>
                <blockquote class="blockquote">
                  <p>"The best bread I've ever had!"</p>
                </blockquote>
                <figcaption class="blockquote-footer">V4l3nt1n0</figcaption>
                <p>
                  "I was amazed by the authenticity of the flavors. The crust is
                  perfectly crispy, and the inside is soft and airy. Will
                  definitely come back for more!"
                </p>
              </figure>
            </div>
          </div>
          <div class="col-lg-4 mb-3" data-aos="fade-up">
            <div class="card p-3">
              <figure>
                <blockquote class="blockquote">
                  <p>"Perfect pastries for any occasion!"</p>
                </blockquote>
                <figcaption class="blockquote-footer">V4l3nt1n0</figcaption>
                <p>
                  "I bought a pastry bundle and got a free fudge—what a treat!
                  Everything was fresh, and the flavors were absolutely
                  delightful. Highly recommended!"
                </p>
              </figure>
            </div>
          </div>
          <div class="col-lg-4 mb-3" data-aos="fade-up">
            <div class="card p-3">
              <figure>
                <blockquote class="blockquote">
                  <p>"Great service and delicious food!"</p>
                </blockquote>
                <figcaption class="blockquote-footer">V4l3nt1n0</figcaption>
                <p>
                  "I had a wonderful dine-in experience. The staff was friendly,
                  and the bread was served warm and fresh. A must-visit for
                  bread lovers!"
                </p>
              </figure>
            </div>
          </div>
          <div class="col-lg-4 mb-3" data-aos="fade-up">
            <div class="card p-3">
              <figure>
                <blockquote class="blockquote">
                  <p>"Fast and reliable delivery!"</p>
                </blockquote>
                <figcaption class="blockquote-footer">V4l3nt1n0</figcaption>
                <p>
                  "Ordered some bread for a family gathering, and it arrived
                  right on time. The packaging kept everything fresh, and the
                  taste was fantastic!"
                </p>
              </figure>
            </div>
          </div>
          <div class="col-lg-4 mb-3" data-aos="fade-up">
            <div class="card p-3">
              <figure>
                <blockquote class="blockquote">
                  <p>"A hidden gem for pastry lovers!"</p>
                </blockquote>
                <figcaption class="blockquote-footer">V4l3nt1n0</figcaption>
                <p>
                  "Tried the pastries for the first time, and I was blown away.
                  Flaky, buttery, and simply delicious. Can’t wait to try more
                  from the menu!"
                </p>
              </figure>
            </div>
          </div>
          <div class="col-lg-4 mb-3" data-aos="fade-up">
            <div class="card p-3">
              <figure>
                <blockquote class="blockquote">
                  <p>"My go-to bakery for authentic taste bread!"</p>
                </blockquote>
                <figcaption class="blockquote-footer">V4l3nt1n0</figcaption>
                <p>
                  "Every bite takes me back to my trip to Italy. The quality is
                  top-notch, and the promotions make it even better!"
                </p>
              </figure>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Review End -->

    <!-- Contact Start -->
    <div class="container-fluid pt-5" id="contact">
      <div class="container">
        <div class="text-center mb-5">
          <h2 class="text-center mb-5 no-select" data-aos="zoom-in">Contact</h2>
        </div>
        <div class="row px-3 pb-2">
          <div class="col-sm-4 text-center mb-3">
            <i
              class="fas fa-2x fa-map-marker-alt mb-3 text-warning"
              data-aos="fade-up"
            ></i>
            <h4 class="fw-bold" data-aos="fade-up">Address</h4>
            <p data-aos="fade-up">SMK Negeri 2 Depok</p>
          </div>
          <div class="col-sm-4 text-center mb-3">
            <i
              class="fas fa-2x fa-phone-alt mb-3 text-warning"
              data-aos="fade-up"
              data-aos-duration="650"
            ></i>
            <h4 class="fw-bold" data-aos="fade-up" data-aos-duration="650">
              Phone
            </h4>
            <p data-aos="fade-up" data-aos-duration="650">+123 XXXX 6789</p>
          </div>
          <div class="col-sm-4 text-center mb-3">
            <i
              class="fas fa-2x fa-envelope mb-3 text-warning"
              data-aos="fade-up"
              data-aos-duration="850"
            ></i>
            <h4 class="fw-bold" data-aos="fade-up" data-aos-duration="850">
              Email
            </h4>
            <p data-aos="fade-up" data-aos-duration="850">lorem123@ipsum.com</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6 pb-5">
            <iframe
              data-aos="fade-up"
              data-aos-duration="650"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d247.07329140111642!2d110.39259060886089!3d-7.7715080593160435!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e7a59233163d4cb%3A0x12a89680108b143d!2sSIJA-TKJ%20SMKN%202%20Depok!5e0!3m2!1sen!2sid!4v1725099182466!5m2!1sen!2sid"
              width="100%"
              height="443"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            >
            </iframe>
          </div>
          <div class="col-md-6 pb-5">
            <div class="contact-form">
              <form action="#" id="contactForm" novalidate>
                <div class="mb-3" data-aos="fade-up" data-aos-duration="650">
                  <input
                    type="text"
                    id="name"
                    class="form-control bg-transparent p-3"
                    placeholder="Your Name"
                    required
                  />
                </div>
                <div class="mb-3" data-aos="fade-up" data-aos-duration="650">
                  <input
                    type="email"
                    id="email"
                    class="form-control bg-transparent p-3"
                    placeholder="Your Email"
                    required
                  />
                </div>
                <div class="mb-3" data-aos="fade-up" data-aos-duration="650">
                  <input
                    type="text"
                    id="subject"
                    class="form-control bg-transparent p-3"
                    placeholder="Your Subject"
                    required
                  />
                </div>
                <div class="mb-3" data-aos="fade-up" data-aos-duration="650">
                  <textarea
                    id="message"
                    rows="5"
                    class="form-control bg-transparent p-3"
                    placeholder="Message"
                    required
                  ></textarea>
                </div>
                <button
                  data-aos="fade-up"
                  data-aos-duration="650"
                  class="btn btn-warning text-light py-3 px-5 rounded"
                  type="submit"
                  id="sendMessageButton"
                >
                  Send Message
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Contact End -->

    <!-- Contact Start -->
    <div class="container-fluid py-5 contact-color text-light">
      <div class="container">
        <h2 class="text-center no-select mb-5" data-aos="zoom-in">
          Contact Us
        </h2>
        <div class="row justify-content-center">
          <div class="d-flex justify-content-center flex-wrap">
            <div class="col-auto d-flex justify-content-center me-3">
              <i class="bi bi-facebook fs-4" data-aos="fade-up"></i>
            </div>
            <div class="col-auto d-flex justify-content-center me-3">
              <i
                class="bi bi-instagram fs-4"
                data-aos="fade-up"
                data-aos-duration="600"
              ></i>
            </div>
            <div class="col-auto d-flex justify-content-center me-3">
              <i
                class="bi bi-twitter fs-4"
                data-aos="fade-up"
                data-aos-duration="750"
              ></i>
            </div>
            <div class="col-auto d-flex justify-content-center">
              <i
                class="bi bi-youtube fs-4"
                data-aos="fade-up"
                data-aos-duration="800"
              ></i>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Contact End -->

    <!-- Footer Start -->
    <div class="container-fluid py-3 text-light footer-color">
      <div class="container d-flex justify-content-center">
        <label class="no-select">&copy; 2025 Kelompok 2</label>
      </div>
    </div>
    <!-- Footer End -->

    <!-- JavaScript Files -->
    <!-- Add this before the closing body tag -->
    <script type="module" src="js/api-products.js"></script>
    <script src="bootstrap-5.0.0-dist/js/bootstrap.bundle.min.js"></script>
    <script src="dist/js/lightbox-plus-jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"
      integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D"
      crossorigin="anonymous"
      async
    ></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      // Initialize AOS library
      AOS.init();

      // Dynamic content sections using API data
      document.addEventListener("DOMContentLoaded", async function () {
        // Helper function to add ngrok-skip-browser-warning header to all requests
        async function fetchWithHeaders(url, options = {}) {
          if (!options.headers) {
            options.headers = {};
          }
          options.headers["ngrok-skip-browser-warning"] = "1";
          options.headers["Content-Type"] =
            options.headers["Content-Type"] || "application/json";
          options.mode = "cors";
          return fetch(url, options);
        }

        // Function to fetch products from API
        async function fetchProducts() {
          try {
            const response = await fetchWithHeaders(
              "https://puma-bold-grubworm.ngrok-free.app/tampil"
            );

            if (!response.ok) {
              throw new Error(`API responded with status: ${response.status}`);
            }

            const responseText = await response.text();
            const data = JSON.parse(responseText);

            if (data.status === 200 && Array.isArray(data.values)) {
              return data.values;
            } else {
              console.error("Invalid API response format:", data);
              return [];
            }
          } catch (error) {
            console.error("Error fetching products:", error);
            return [];
          }
        }

        // Function to fetch promos from API
        async function fetchPromos() {
          try {
            const response = await fetchWithHeaders(
              "https://puma-bold-grubworm.ngrok-free.app/promo"
            );

            if (!response.ok) {
              throw new Error(`API responded with status: ${response.status}`);
            }

            const responseText = await response.text();
            const data = JSON.parse(responseText);

            if (data.status === 200 && Array.isArray(data.values)) {
              return data.values;
            } else {
              console.error("Invalid API response format:", data);
              return [];
            }
          } catch (error) {
            console.error("Error fetching promos:", error);
            return [];
          }
        }

        // Function to render favorites section
        async function renderFavorites() {
          // Get the container
          const favoritesContainer = document.getElementById(
            "favorites-container"
          );

          // Check if the favorites container exists on the current page
          if (!favoritesContainer) {
            console.log("Favorites container not found on this page");
            return; // Exit if container doesn't exist
          }

          console.log("Rendering favorites section...");

          // Get products from API
          const products = await fetchProducts();

          // Ensure we have products before continuing
          if (!products || products.length === 0) {
            console.log("No products found to display in favorites");
            return;
          }

          // Clear existing content in favorites container ONLY
          favoritesContainer.innerHTML = "";

          // Take only the first 4 products or all if less than 4
          const favProducts = products.slice(0, 4);

          // Add products to the favorites container
          favProducts.forEach((product, index) => {
            const productElement = document.createElement("div");
            productElement.className = "col-sm-6 col-lg-3 mb-3";
            productElement.setAttribute("data-aos", "fade-up");

            if (index > 0) {
              productElement.setAttribute(
                "data-aos-duration",
                (600 + index * 50).toString()
              );
            }

            productElement.innerHTML = `
        <div class="card under-shadow2">
          <a href="${product.image}" data-lightbox="product-${
              product.id
            }" data-title="${product.name}">
            <img src="${product.image}" class="card-img-top" alt="${
              product.name
            }" />
          </a>
          <div class="card-body text-center">
            <h5 class="card-title">${product.name}</h5>
            <p class="card-text">${product.description}</p>
            <p class="text-warning">Rp ${parseInt(product.price).toLocaleString(
              "id-ID"
            )}</p>
          </div>
        </div>
      `;

            favoritesContainer.appendChild(productElement);
          });

          console.log(
            `Added ${favProducts.length} products to favorites section`
          );
        }

        // Function to render special offers
        async function renderSpecialOffers() {
          // Get the container
          const specialOffersContainer = document.getElementById(
            "special-offers-container"
          );

          // Check if the special offers container exists on the current page
          if (!specialOffersContainer) {
            console.log("Special offers container not found on this page");
            return; // Exit if container doesn't exist
          }

          console.log("Rendering special offers section...");

          // Get all promos from API
          const allPromos = await fetchPromos();

          console.log("All promos from API (Special Offers):", allPromos);

          // Filter for specific promo titles
          const targetTitles = [
            "Bundle & Save – Free Gingerbread with Every 5 Purchased!",
            "Buy One, Get a Muffin Free – Sweeten Your Day!",
            "Vanilla Chiffon Bliss – Light, Elegant, and 10% Off!",
          ];

          const specialOffers = allPromos.filter((promo) =>
            targetTitles.includes(promo.title)
          );

          console.log("Filtered special offers:", specialOffers);

          // Clear existing content in special offers container ONLY
          specialOffersContainer.innerHTML = "";

          // Check if we have any special offers to display
          if (specialOffers.length === 0) {
            console.log("No matching special offers found");
            return; // Exit the function if no offers match
          }

          // Add the special offers to the container
          specialOffers.forEach((promo, index) => {
            const promoElement = document.createElement("div");
            promoElement.className = "col-sm-6 col-lg-3 mb-3";
            promoElement.setAttribute("data-aos", "fade-up");

            if (index > 0) {
              promoElement.setAttribute(
                "data-aos-duration",
                (600 + index * 50).toString()
              );
            }

            // Create slug from title
            const slug = promo.title.toLowerCase().replace(/\s+/g, "-");

            // Format dates for display
            const formatDate = (dateString) => {
              const date = new Date(dateString);
              return date.toLocaleDateString("en-US", {
                year: "numeric",
                month: "short",
                day: "numeric",
              });
            };

            const startDate = formatDate(promo.time_start);
            const endDate = formatDate(promo.time_end);

            promoElement.innerHTML = `
        <div class="card under-shadow2">
          <a
            href="${promo.image}"
            data-lightbox="${slug}"
            data-title="${promo.title}"
          >
            <img
              src="${promo.image}"
              class="card-img-top"
              alt="${promo.title}"
            />
          </a>
          <div class="card-body text-center">
            <h5 class="card-title text-warning">${promo.title
              .split("–")[0]
              .trim()}</h5>
            <p class="card-text">
              ${promo.description}
            </p>
            <p class="text-warning">
              <small>Valid: ${startDate} - ${endDate}</small>
            </p>
          </div>
        </div>
      `;

            specialOffersContainer.appendChild(promoElement);
          });

          console.log(
            `Added ${specialOffers.length} promos to special offers section`
          );
        }

        // IMPORTANT: Execute the functions sequentially, with proper error handling
        try {
          // First check if each container exists
          const specialOffersContainer = document.getElementById(
            "special-offers-container"
          );
          const favoritesContainer = document.getElementById(
            "favorites-container"
          );

          // Execute special offers first if container exists
          if (specialOffersContainer) {
            await renderSpecialOffers();
          }

          // Then execute favorites if container exists
          if (favoritesContainer) {
            await renderFavorites();
          }
        } catch (error) {
          console.error("Error rendering content:", error);
        }
      });
    </script>
  </body>
</html>
